# ğŸ“‹ é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ»SOP

## ğŸ”„ æ—¥æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ğŸŒ… æœã®ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯ï¼ˆ8:00ï¼‰

```markdown
## æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - æœ (8:00)
å®Ÿæ–½è€…: ___________  å®Ÿæ–½æ—¥: ___________

### ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³
- [ ] Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ­£å¸¸å¿œç­”ç¢ºèª (http://localhost:8000/health/)
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª (PostgreSQL)
- [ ] Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ç¢ºèª
- [ ] Celery Worker ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
- [ ] Nginx ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ç¢ºèª

### ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
- [ ] CPUä½¿ç”¨ç‡ < 70%
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ < 80%
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ < 80%
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸä½¿ç”¨ç‡æ­£å¸¸

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèª
- [ ] ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œãƒ­ã‚°ç¢ºèª
- [ ] SSLè¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ç¢ºèª (30æ—¥ä»¥ä¸Š)
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèª

### æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ç¢ºèª
- [ ] å‰æ—¥ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª
- [ ] æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²å‡¦ç†ç¢ºèª
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª (é‡è¦åº¦HIGHä»¥ä¸Š)
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å•ã„åˆã‚ã›ç¢ºèª

### ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥ç¢ºèª
- [ ] å¤œé–“ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ç¢ºèª
- [ ] ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸å‹•ä½œç¢ºèª
- [ ] ç·Šæ€¥é€£çµ¡ä½“åˆ¶ç¢ºèª
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†ç¢ºèª

ã‚³ãƒ¡ãƒ³ãƒˆ/æ³¨æ„äº‹é …:
________________________________
```

### ğŸŒƒ å¤œé–“ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯ï¼ˆ22:00ï¼‰

```markdown
## æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - å¤œ (22:00)
å®Ÿæ–½è€…: ___________  å®Ÿæ–½æ—¥: ___________

### æ—¥ä¸­æ¥­å‹™å‡¦ç†ç¢ºèª
- [ ] ã‚·ãƒ•ãƒˆå¤‰æ›´è¦æ±‚å‡¦ç†çŠ¶æ³ç¢ºèª
- [ ] ç·Šæ€¥å‘¼å‡ºå±¥æ­´ç¢ºèª
- [ ] ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨çµ±è¨ˆç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿä»¶æ•°ç¢ºèª

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æº–å‚™
- [ ] è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šç¢ºèª
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®¹é‡ç¢ºèª
- [ ] å‰å›ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç¢ºèª
- [ ] å¾©æ—§ãƒ†ã‚¹ãƒˆè¨ˆç”»ç¢ºèª

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‚¹æ¤œ
- [ ] æ—¥ä¸­ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°åˆ†æ
- [ ] ç•°å¸¸ãªæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª
- [ ] ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°ç¢ºèª
- [ ] æ¨©é™å¤‰æ›´å±¥æ­´ç¢ºèª

### ç¿Œæ—¥æº–å‚™
- [ ] äºˆå®šã•ã‚ŒãŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç¢ºèª
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆè¨ˆç”»ç¢ºèª
- [ ] ç·Šæ€¥é€£çµ¡å…ˆæ›´æ–°ç¢ºèª
- [ ] ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šç¢ºèª

ã‚³ãƒ¡ãƒ³ãƒˆ/æ³¨æ„äº‹é …:
________________________________
```

## ğŸ“… é€±æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ğŸ—“ï¸ æ¯é€±æœˆæ›œæ—¥å®Ÿæ–½

```markdown
## é€±æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
å®Ÿæ–½è€…: ___________  å®Ÿæ–½é€±: ___________

### ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½åˆ†æ
- [ ] éå»1é€±é–“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“åˆ†æ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ€§èƒ½çµ±è¨ˆç¢ºèª
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡æ¨ç§»ç¢ºèª
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†æ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°é€±æ¬¡åˆ†æ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç›£æŸ»
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼éµå®ˆç¢ºèª

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
- [ ] ãƒ‡ãƒ¼ã‚¿å¾©æ—§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] ç›£æŸ»ãƒ­ã‚°å®Œå…¨æ€§ç¢ºèª

### å®¹é‡ãƒ»æˆé•·è¨ˆç”»
- [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡äºˆæ¸¬
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å¢—åŠ å‚¾å‘åˆ†æ
- [ ] ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µè¨ˆç”»ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å€™è£œç¢ºèª

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] é‹ç”¨æ‰‹é †æ›¸æ›´æ–°ç¢ºèª
- [ ] ç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †æ›´æ–°
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ›´æ–°
- [ ] ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³æ›´æ–°

ã‚³ãƒ¡ãƒ³ãƒˆ/æ³¨æ„äº‹é …:
________________________________
```

## ğŸ—“ï¸ æœˆæ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ğŸ“Š æ¯æœˆ1æ—¥å®Ÿæ–½

```markdown
## æœˆæ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
å®Ÿæ–½è€…: ___________  å®Ÿæ–½æœˆ: ___________

### åŒ…æ‹¬çš„ã‚·ã‚¹ãƒ†ãƒ ç›£æŸ»
- [ ] å…¨ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¥å…¨æ€§ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼éµå®ˆçŠ¶æ³ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç¢ºèª
- [ ] ç½å®³å¾©æ—§è¨ˆç”»æœ‰åŠ¹æ€§ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–
- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ç¢ºèª
- [ ] ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ­ã‚°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹å†é…åˆ†æ¤œè¨

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»æ¨©é™ç®¡ç†
- [ ] éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª
- [ ] æ¨©é™ãƒ¬ãƒ™ãƒ«é©æ­£æ€§ç¢ºèª
- [ ] ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç›£æŸ»
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°æ¨å¥¨é€šçŸ¥

### æ³•çš„ãƒ»è¦åˆ¶å¯¾å¿œ
- [ ] HIPAAæº–æ‹ çŠ¶æ³ç¢ºèª
- [ ] å€‹äººæƒ…å ±ä¿è­·æ³•å¯¾å¿œç¢ºèª
- [ ] åŒ»ç™‚æ©Ÿé–¢å‘ã‘è¦åˆ¶å¯¾å¿œç¢ºèª
- [ ] ç›£æŸ»ãƒ­ã‚°ä¿å­˜æœŸé–“ç¢ºèª

### ãƒ“ã‚¸ãƒã‚¹ç¶™ç¶šæ€§
- [ ] ç½å®³å¾©æ—§è¨ˆç”»ãƒ†ã‚¹ãƒˆ
- [ ] ç·Šæ€¥æ™‚é€£çµ¡ä½“åˆ¶æ›´æ–°
- [ ] ã‚·ã‚¹ãƒ†ãƒ å†—é•·æ€§ç¢ºèª
- [ ] ä»£æ›¿æ‰‹é †æœ‰åŠ¹æ€§ç¢ºèª

ã‚³ãƒ¡ãƒ³ãƒˆ/æ³¨æ„äº‹é …:
________________________________
```

## ğŸš¨ ç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †ï¼ˆSOPï¼‰

### ğŸ“ ç·Šæ€¥æ™‚é€£çµ¡ä½“åˆ¶

```markdown
## ç·Šæ€¥æ™‚é€£çµ¡å…ˆ

### ãƒ¬ãƒ™ãƒ«1: ã‚·ã‚¹ãƒ†ãƒ éšœå®³
**å¯¾è±¡**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹éšœå®³
**å¯¾å¿œæ™‚é–“**: å³åº§ï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰

1. ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…: xxx-xxxx-xxxx
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…: xxx-xxxx-xxxx  
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç®¡ç†è€…: xxx-xxxx-xxxx
4. ç—…é™¢ITè²¬ä»»è€…: xxx-xxxx-xxxx

### ãƒ¬ãƒ™ãƒ«2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
**å¯¾è±¡**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ç–‘ã„
**å¯¾å¿œæ™‚é–“**: å³åº§ï¼ˆ1æ™‚é–“ä»¥å†…ï¼‰

1. CISO (æœ€é«˜æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è²¬ä»»è€…): xxx-xxxx-xxxx
2. ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…: xxx-xxxx-xxxx
3. æ³•å‹™æ‹…å½“è€…: xxx-xxxx-xxxx
4. ç—…é™¢ç®¡ç†è€…: xxx-xxxx-xxxx

### ãƒ¬ãƒ™ãƒ«3: ãƒ‡ãƒ¼ã‚¿æå¤±
**å¯¾è±¡**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç ´æã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—
**å¯¾å¿œæ™‚é–“**: å³åº§ï¼ˆ30åˆ†ä»¥å†…ï¼‰

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…: xxx-xxxx-xxxx
2. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†è€…: xxx-xxxx-xxxx
3. ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…: xxx-xxxx-xxxx
4. ç—…é™¢ITè²¬ä»»è€…: xxx-xxxx-xxxx
```

### ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ éšœå®³å¯¾å¿œæ‰‹é †

```bash
#!/bin/bash
# emergency_response.sh
# ã‚·ã‚¹ãƒ†ãƒ éšœå®³æ™‚ã®ç·Šæ€¥å¯¾å¿œæ‰‹é †

echo "=== ShiftMaster ç·Šæ€¥å¯¾å¿œãƒ—ãƒ­ãƒˆã‚³ãƒ« ==="
echo "å®Ÿè¡Œæ™‚åˆ»: $(date)"
echo "å®Ÿè¡Œè€…: $USER"
echo ""

# 1. éšœå®³çŠ¶æ³ç¢ºèª
echo "1. éšœå®³çŠ¶æ³ç¢ºèªä¸­..."
check_system_status() {
    echo "1-1. Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç¢ºèª"
    curl -s --connect-timeout 5 http://localhost:8000/health/ || echo "âŒ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¿œç­”ãªã—"
    
    echo "1-2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª"
    sudo -u postgres psql -d shiftmaster -c "SELECT 1;" 2>/dev/null || echo "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—"
    
    echo "1-3. Redisç¢ºèª"
    redis-cli ping 2>/dev/null || echo "âŒ Rediså¿œç­”ãªã—"
    
    echo "1-4. ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª"
    echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)"
    echo "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡: $(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')"
    echo "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡: $(df -h / | awk 'NR==2{print $5}')"
}

# 2. ç·Šæ€¥å¾©æ—§æ‰‹é †
echo "2. ç·Šæ€¥å¾©æ—§æ‰‹é †å®Ÿè¡Œ..."
emergency_recovery() {
    echo "2-1. ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•è©¦è¡Œ"
    systemctl restart shiftmaster || echo "âŒ ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•å¤±æ•—"
    systemctl restart nginx || echo "âŒ Nginxå†èµ·å‹•å¤±æ•—"
    systemctl restart postgresql || echo "âŒ PostgreSQLå†èµ·å‹•å¤±æ•—"
    systemctl restart redis || echo "âŒ Rediså†èµ·å‹•å¤±æ•—"
    
    echo "2-2. ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ"
    EMERGENCY_BACKUP="/tmp/emergency_backup_$(date +%Y%m%d_%H%M%S)"
    mkdir -p $EMERGENCY_BACKUP
    
    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    cp -r /etc/nginx/sites-available/shiftmaster $EMERGENCY_BACKUP/
    cp -r /var/www/shiftmaster/.env $EMERGENCY_BACKUP/
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ€ãƒ³ãƒ—ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
    sudo -u postgres pg_dump shiftmaster > $EMERGENCY_BACKUP/emergency_db_dump.sql 2>/dev/null || echo "âŒ ç·Šæ€¥DBãƒ€ãƒ³ãƒ—å¤±æ•—"
    
    echo "ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: $EMERGENCY_BACKUP"
}

# 3. ãƒ­ã‚°åé›†
echo "3. éšœå®³ãƒ­ã‚°åé›†..."
collect_emergency_logs() {
    LOG_COLLECTION="/tmp/emergency_logs_$(date +%Y%m%d_%H%M%S)"
    mkdir -p $LOG_COLLECTION
    
    # ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°
    journalctl -u shiftmaster --since "1 hour ago" > $LOG_COLLECTION/shiftmaster.log
    journalctl -u nginx --since "1 hour ago" > $LOG_COLLECTION/nginx.log
    journalctl -u postgresql --since "1 hour ago" > $LOG_COLLECTION/postgresql.log
    
    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
    tail -100 /var/log/shiftmaster/error.log > $LOG_COLLECTION/app_errors.log 2>/dev/null
    tail -100 /var/log/nginx/error.log > $LOG_COLLECTION/nginx_errors.log 2>/dev/null
    
    # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
    ps aux > $LOG_COLLECTION/processes.log
    netstat -tulpn > $LOG_COLLECTION/network.log
    df -h > $LOG_COLLECTION/disk.log
    free -h > $LOG_COLLECTION/memory.log
    
    echo "ãƒ­ã‚°åé›†å®Œäº†: $LOG_COLLECTION"
}

# 4. é€šçŸ¥é€ä¿¡
echo "4. ç·Šæ€¥é€šçŸ¥é€ä¿¡..."
send_emergency_notification() {
    ALERT_MESSAGE="ã€ç·Šæ€¥ã€‘ShiftMaster ã‚·ã‚¹ãƒ†ãƒ éšœå®³ç™ºç”Ÿ
ç™ºç”Ÿæ™‚åˆ»: $(date)
å®Ÿè¡Œè€…: $USER
çŠ¶æ³: ç·Šæ€¥å¾©æ—§æ‰‹é †å®Ÿè¡Œä¸­
ãƒ­ã‚°: $LOG_COLLECTION
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $EMERGENCY_BACKUP

ç·Šæ€¥é€£çµ¡å…ˆã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚"

    # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    echo "$ALERT_MESSAGE" | mail -s "ã€ç·Šæ€¥ã€‘ShiftMasteréšœå®³" admin@hospital.local 2>/dev/null || echo "ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—"
    
    # Slacké€šçŸ¥ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    curl -X POST -H 'Content-type: application/json' \
        --data "{\"text\":\"$ALERT_MESSAGE\"}" \
        $SLACK_WEBHOOK_URL 2>/dev/null || echo "Slacké€šçŸ¥å¤±æ•—"
}

# ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
check_system_status
echo ""
emergency_recovery
echo ""
collect_emergency_logs
echo ""
send_emergency_notification

echo "=== ç·Šæ€¥å¯¾å¿œå®Œäº† ==="
echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "1. ç·Šæ€¥é€£çµ¡å…ˆã«çŠ¶æ³å ±å‘Š"
echo "2. åé›†ã—ãŸãƒ­ã‚°ã®è©³ç´°åˆ†æ"
echo "3. æ ¹æœ¬åŸå› ã®èª¿æŸ»é–‹å§‹"
echo "4. æ’ä¹…å¯¾ç­–ã®æ¤œè¨ãƒ»å®Ÿè£…"
```

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

```python
#!/usr/bin/env python
# security_incident_response.py
"""
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import datetime
import subprocess
import os
import hashlib
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class SecurityIncidentResponse:
    def __init__(self):
        self.incident_id = self.generate_incident_id()
        self.response_dir = f"/var/log/security/incident_{self.incident_id}"
        self.ensure_response_directory()
    
    def generate_incident_id(self):
        """ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆIDç”Ÿæˆ"""
        timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        return f"SEC_{timestamp}"
    
    def ensure_response_directory(self):
        """å¯¾å¿œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ"""
        os.makedirs(self.response_dir, exist_ok=True)
        logger.info(f"ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ: {self.response_dir}")
    
    def isolate_affected_systems(self):
        """å½±éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã®éš”é›¢"""
        logger.info("å½±éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã®éš”é›¢é–‹å§‹...")
        
        try:
            # ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
            subprocess.run([
                "iptables", "-A", "INPUT", "-p", "tcp", "--dport", "8000", "-j", "DROP"
            ], check=True)
            
            # ç–‘ã‚ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ–­
            subprocess.run([
                "pkill", "-f", "suspicious_process"
            ])
            
            logger.info("âœ… ã‚·ã‚¹ãƒ†ãƒ éš”é›¢å®Œäº†")
            return True
        except Exception as e:
            logger.error(f"âŒ ã‚·ã‚¹ãƒ†ãƒ éš”é›¢å¤±æ•—: {e}")
            return False
    
    def preserve_evidence(self):
        """è¨¼æ‹ ä¿å…¨"""
        logger.info("è¨¼æ‹ ä¿å…¨é–‹å§‹...")
        
        evidence_files = [
            "/var/log/auth.log",
            "/var/log/syslog", 
            "/var/log/shiftmaster/access.log",
            "/var/log/nginx/access.log",
            "/var/log/postgresql/postgresql.log"
        ]
        
        for file_path in evidence_files:
            if os.path.exists(file_path):
                # ãƒãƒƒã‚·ãƒ¥å€¤è¨ˆç®—
                hash_value = self.calculate_file_hash(file_path)
                
                # è¨¼æ‹ ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
                evidence_copy = f"{self.response_dir}/{os.path.basename(file_path)}"
                subprocess.run(["cp", file_path, evidence_copy])
                
                # ãƒãƒƒã‚·ãƒ¥å€¤è¨˜éŒ²
                with open(f"{evidence_copy}.hash", "w") as f:
                    f.write(f"{hash_value}  {os.path.basename(file_path)}\n")
                
                logger.info(f"è¨¼æ‹ ä¿å…¨å®Œäº†: {file_path}")
    
    def calculate_file_hash(self, file_path):
        """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥å€¤è¨ˆç®—"""
        sha256_hash = hashlib.sha256()
        with open(file_path, "rb") as f:
            for chunk in iter(lambda: f.read(4096), b""):
                sha256_hash.update(chunk)
        return sha256_hash.hexdigest()
    
    def analyze_security_logs(self):
        """ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°åˆ†æ"""
        logger.info("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°åˆ†æé–‹å§‹...")
        
        analysis_results = {
            "failed_logins": self.count_failed_logins(),
            "suspicious_ips": self.identify_suspicious_ips(),
            "unusual_access_patterns": self.analyze_access_patterns(),
            "privilege_escalations": self.check_privilege_escalations()
        }
        
        # åˆ†æçµæœä¿å­˜
        with open(f"{self.response_dir}/analysis_results.txt", "w") as f:
            for category, results in analysis_results.items():
                f.write(f"=== {category.upper()} ===\n")
                for result in results:
                    f.write(f"{result}\n")
                f.write("\n")
        
        return analysis_results
    
    def count_failed_logins(self):
        """ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ"""
        try:
            result = subprocess.run([
                "grep", "Failed password", "/var/log/auth.log"
            ], capture_output=True, text=True)
            
            failed_logins = result.stdout.strip().split('\n')
            return [f"ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ç·æ•°: {len(failed_logins)}"] + failed_logins[-10:]
        except:
            return ["ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ãƒ­ã‚°åˆ†æã‚¨ãƒ©ãƒ¼"]
    
    def identify_suspicious_ips(self):
        """ç–‘ã‚ã—ã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ç‰¹å®š"""
        # å®Ÿè£…ä¾‹: ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‹ã‚‰ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º
        suspicious_ips = []
        
        try:
            result = subprocess.run([
                "awk", '{print $1}', "/var/log/nginx/access.log"
            ], capture_output=True, text=True)
            
            # IPåˆ¥ã‚¢ã‚¯ã‚»ã‚¹æ•°é›†è¨ˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
            ip_counts = {}
            for ip in result.stdout.strip().split('\n'):
                ip_counts[ip] = ip_counts.get(ip, 0) + 1
            
            # ç•°å¸¸ã«å¤šã„ã‚¢ã‚¯ã‚»ã‚¹ã®IPã‚’æŠ½å‡º
            for ip, count in ip_counts.items():
                if count > 1000:  # é–¾å€¤ã¯ç’°å¢ƒã«å¿œã˜ã¦èª¿æ•´
                    suspicious_ips.append(f"é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹IP: {ip} ({count} å›)")
        
        except:
            suspicious_ips.append("ç–‘ã‚ã—ã„IPåˆ†æã‚¨ãƒ©ãƒ¼")
        
        return suspicious_ips
    
    def analyze_access_patterns(self):
        """ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ"""
        patterns = []
        
        try:
            # æ™‚é–“å¤–ã‚¢ã‚¯ã‚»ã‚¹æ¤œå‡º
            result = subprocess.run([
                "grep", "$(date -d '23:00' +%H)", "/var/log/shiftmaster/access.log"
            ], capture_output=True, text=True)
            
            if result.stdout:
                patterns.append(f"æ·±å¤œã‚¢ã‚¯ã‚»ã‚¹æ¤œå‡º: {len(result.stdout.strip().split())} ä»¶")
            
            # ç®¡ç†è€…æ¨©é™ã‚¢ã‚¯ã‚»ã‚¹æ¤œå‡º
            result = subprocess.run([
                "grep", "admin", "/var/log/shiftmaster/access.log"
            ], capture_output=True, text=True)
            
            if result.stdout:
                patterns.append(f"ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹: {len(result.stdout.strip().split())} ä»¶")
        
        except:
            patterns.append("ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã‚¨ãƒ©ãƒ¼")
        
        return patterns
    
    def check_privilege_escalations(self):
        """æ¨©é™æ˜‡æ ¼ãƒã‚§ãƒƒã‚¯"""
        escalations = []
        
        try:
            result = subprocess.run([
                "grep", "sudo", "/var/log/auth.log"
            ], capture_output=True, text=True)
            
            sudo_attempts = result.stdout.strip().split('\n')
            escalations.append(f"sudoå®Ÿè¡Œç·æ•°: {len(sudo_attempts)}")
            
            # æœ€è¿‘ã®sudoå®Ÿè¡Œï¼ˆæœ€æ–°10ä»¶ï¼‰
            escalations.extend(sudo_attempts[-10:])
        
        except:
            escalations.append("æ¨©é™æ˜‡æ ¼ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼")
        
        return escalations
    
    def generate_incident_report(self, analysis_results):
        """ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
        report_path = f"{self.response_dir}/incident_report.md"
        
        report_content = f"""# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Šæ›¸

## ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåŸºæœ¬æƒ…å ±
- **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID**: {self.incident_id}
- **ç™ºç”Ÿæ—¥æ™‚**: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %Hæ™‚%Måˆ†')}
- **æ¤œå‡ºæ–¹æ³•**: è‡ªå‹•ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
- **å¯¾å¿œè€…**: {os.getenv('USER', 'ä¸æ˜')}

## å¯¾å¿œçŠ¶æ³
- **éš”é›¢æªç½®**: å®Ÿæ–½æ¸ˆã¿
- **è¨¼æ‹ ä¿å…¨**: å®Ÿæ–½æ¸ˆã¿
- **ãƒ­ã‚°åˆ†æ**: å®Ÿæ–½æ¸ˆã¿

## åˆ†æçµæœã‚µãƒãƒªãƒ¼
"""
        
        for category, results in analysis_results.items():
            report_content += f"\n### {category.replace('_', ' ').title()}\n"
            for result in results[:5]:  # ä¸Šä½5ä»¶ã®ã¿è¡¨ç¤º
                report_content += f"- {result}\n"
        
        report_content += f"""
## æ¨å¥¨äº‹é …
1. å½±éŸ¿ç¯„å›²ã®è©³ç´°èª¿æŸ»
2. è„†å¼±æ€§ã®ç‰¹å®šãƒ»ä¿®æ­£
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼è¦‹ç›´ã—
4. ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ•™è‚²

## æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
- è¨¼æ‹ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: {self.response_dir}/
- åˆ†æçµæœè©³ç´°: {self.response_dir}/analysis_results.txt

---
**å ±å‘Šè€…**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…  
**ä½œæˆæ—¥æ™‚**: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %Hæ™‚%Måˆ†')}
"""
        
        with open(report_path, "w", encoding="utf-8") as f:
            f.write(report_content)
        
        logger.info(f"ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: {report_path}")
        return report_path
    
    def execute_full_response(self):
        """å®Œå…¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œå®Ÿè¡Œ"""
        logger.info(f"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹: {self.incident_id}")
        
        # 1. ã‚·ã‚¹ãƒ†ãƒ éš”é›¢
        self.isolate_affected_systems()
        
        # 2. è¨¼æ‹ ä¿å…¨
        self.preserve_evidence()
        
        # 3. ãƒ­ã‚°åˆ†æ
        analysis_results = self.analyze_security_logs()
        
        # 4. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        report_path = self.generate_incident_report(analysis_results)
        
        logger.info("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œå®Œäº†")
        return {
            "incident_id": self.incident_id,
            "response_directory": self.response_dir,
            "report_path": report_path
        }

if __name__ == "__main__":
    response = SecurityIncidentResponse()
    result = response.execute_full_response()
    
    print(f"=== ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œå®Œäº† ===")
    print(f"ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID: {result['incident_id']}")
    print(f"å¯¾å¿œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: {result['response_directory']}")
    print(f"å ±å‘Šæ›¸: {result['report_path']}")
    print("\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:")
    print("1. CISOãƒ»ç®¡ç†è€…ã¸ã®å³åº§å ±å‘Š")
    print("2. æ³•åŸ·è¡Œæ©Ÿé–¢ã¸ã®é€šå ±æ¤œè¨")
    print("3. å½±éŸ¿ã‚’å—ã‘ãŸé–¢ä¿‚è€…ã¸ã®é€šçŸ¥")
    print("4. æ’ä¹…å¯¾ç­–ã®æ¤œè¨ãƒ»å®Ÿè£…")
```

## ğŸ“Š é‹ç”¨KPIãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ å¯ç”¨æ€§KPI

```python
# monitoring/kpi_calculator.py
"""
ShiftMaster é‹ç”¨KPIè¨ˆç®—ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
"""

import datetime
from dataclasses import dataclass
from typing import List, Dict
import json

@dataclass
class KPIMetrics:
    """KPIãƒ¡ãƒˆãƒªã‚¯ã‚¹å®šç¾©"""
    availability: float  # å¯ç”¨æ€§ (%)
    response_time_p95: float  # å¿œç­”æ™‚é–“95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« (ms)
    error_rate: float  # ã‚¨ãƒ©ãƒ¼ç‡ (%)
    throughput: float  # ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ (req/sec)
    mttr: float  # å¹³å‡å¾©æ—§æ™‚é–“ (minutes)
    mtbf: float  # å¹³å‡æ•…éšœé–“éš” (hours)

class KPICalculator:
    def __init__(self):
        self.sla_targets = {
            "availability": 99.9,  # 99.9%
            "response_time_p95": 200,  # 200ms
            "error_rate": 0.1,  # 0.1%
            "throughput": 1000,  # 1000 req/sec
            "mttr": 15,  # 15åˆ†
            "mtbf": 720  # 30æ—¥
        }
    
    def calculate_monthly_kpi(self, year: int, month: int) -> KPIMetrics:
        """æœˆæ¬¡KPIè¨ˆç®—"""
        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        # ã“ã“ã§ã¯ä¾‹ç¤ºçš„ãªè¨ˆç®—ã‚’ç¤ºã™
        
        # å¯ç”¨æ€§è¨ˆç®—
        total_minutes = self.get_total_minutes_in_month(year, month)
        downtime_minutes = self.get_downtime_minutes(year, month)
        availability = ((total_minutes - downtime_minutes) / total_minutes) * 100
        
        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ï¼ˆ95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼‰
        response_times = self.get_response_times(year, month)
        response_time_p95 = self.calculate_percentile(response_times, 95)
        
        # ã‚¨ãƒ©ãƒ¼ç‡
        total_requests = self.get_total_requests(year, month)
        error_requests = self.get_error_requests(year, month)
        error_rate = (error_requests / total_requests) * 100 if total_requests > 0 else 0
        
        # ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
        throughput = total_requests / (total_minutes * 60)  # req/sec
        
        # MTTRï¼ˆå¹³å‡å¾©æ—§æ™‚é–“ï¼‰
        incidents = self.get_incidents(year, month)
        mttr = sum(incident['resolution_time'] for incident in incidents) / len(incidents) if incidents else 0
        
        # MTBFï¼ˆå¹³å‡æ•…éšœé–“éš”ï¼‰
        mtbf = total_minutes / len(incidents) if incidents else total_minutes
        
        return KPIMetrics(
            availability=availability,
            response_time_p95=response_time_p95,
            error_rate=error_rate,
            throughput=throughput,
            mttr=mttr,
            mtbf=mtbf / 60  # æ™‚é–“å˜ä½ã«å¤‰æ›
        )
    
    def generate_kpi_report(self, metrics: KPIMetrics, year: int, month: int) -> str:
        """KPIãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
        report = f"""
# ShiftMaster æœˆæ¬¡é‹ç”¨KPIãƒ¬ãƒãƒ¼ãƒˆ
**å¯¾è±¡æœŸé–“**: {year}å¹´{month}æœˆ

## ğŸ“Š ä¸»è¦KPI

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | å®Ÿç¸¾å€¤ | SLAç›®æ¨™ | é”æˆçŠ¶æ³ |
|-----------|--------|---------|----------|
| **å¯ç”¨æ€§** | {metrics.availability:.3f}% | {self.sla_targets['availability']}% | {'âœ…' if metrics.availability >= self.sla_targets['availability'] else 'âŒ'} |
| **å¿œç­”æ™‚é–“(P95)** | {metrics.response_time_p95:.1f}ms | {self.sla_targets['response_time_p95']}ms | {'âœ…' if metrics.response_time_p95 <= self.sla_targets['response_time_p95'] else 'âŒ'} |
| **ã‚¨ãƒ©ãƒ¼ç‡** | {metrics.error_rate:.3f}% | {self.sla_targets['error_rate']}% | {'âœ…' if metrics.error_rate <= self.sla_targets['error_rate'] else 'âŒ'} |
| **ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ** | {metrics.throughput:.1f} req/sec | {self.sla_targets['throughput']} req/sec | {'âœ…' if metrics.throughput >= self.sla_targets['throughput'] else 'âŒ'} |
| **MTTR** | {metrics.mttr:.1f}åˆ† | {self.sla_targets['mttr']}åˆ† | {'âœ…' if metrics.mttr <= self.sla_targets['mttr'] else 'âŒ'} |
| **MTBF** | {metrics.mtbf:.1f}æ™‚é–“ | {self.sla_targets['mtbf']}æ™‚é–“ | {'âœ…' if metrics.mtbf >= self.sla_targets['mtbf'] else 'âŒ'} |

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

### å¯ç”¨æ€§åˆ†æ
- **ç¨¼åƒæ™‚é–“**: {self.get_total_minutes_in_month(year, month) - self.get_downtime_minutes(year, month):.0f}åˆ†
- **åœæ­¢æ™‚é–“**: {self.get_downtime_minutes(year, month):.0f}åˆ†
- **ä¸»è¦åœæ­¢åŸå› **: {self.get_top_downtime_causes(year, month)}

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“åˆ†æ
- **å¹³å‡å¿œç­”æ™‚é–“**: {self.get_avg_response_time(year, month):.1f}ms
- **æœ€å¤§å¿œç­”æ™‚é–“**: {self.get_max_response_time(year, month):.1f}ms
- **æ”¹å–„å‚¾å‘**: {self.get_response_time_trend(year, month)}

## ğŸ¯ SLAé”æˆåº¦ã‚µãƒãƒªãƒ¼

**SLAé”æˆç‡**: {self.calculate_sla_achievement_rate(metrics):.1f}%

### ç›®æ¨™é”æˆé …ç›®
{self.get_achieved_targets(metrics)}

### è¦æ”¹å–„é …ç›®
{self.get_improvement_targets(metrics)}

## ğŸ“‹ æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

{self.generate_improvement_plan(metrics)}

---
**ãƒ¬ãƒãƒ¼ãƒˆä½œæˆæ—¥**: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}  
**ä½œæˆè€…**: ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ãƒãƒ¼ãƒ 
"""
        return report
    
    def get_total_minutes_in_month(self, year: int, month: int) -> float:
        """æœˆã®ç·åˆ†æ•°ã‚’å–å¾—"""
        import calendar
        days = calendar.monthrange(year, month)[1]
        return days * 24 * 60
    
    def get_downtime_minutes(self, year: int, month: int) -> float:
        """åœæ­¢æ™‚é–“ã‚’å–å¾—ï¼ˆå®Ÿè£…ä¾‹ï¼‰"""
        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾—
        return 30  # ä¾‹: 30åˆ†ã®åœæ­¢æ™‚é–“
    
    def calculate_sla_achievement_rate(self, metrics: KPIMetrics) -> float:
        """SLAé”æˆç‡è¨ˆç®—"""
        achievements = [
            metrics.availability >= self.sla_targets['availability'],
            metrics.response_time_p95 <= self.sla_targets['response_time_p95'],
            metrics.error_rate <= self.sla_targets['error_rate'],
            metrics.throughput >= self.sla_targets['throughput'],
            metrics.mttr <= self.sla_targets['mttr'],
            metrics.mtbf >= self.sla_targets['mtbf']
        ]
        return (sum(achievements) / len(achievements)) * 100
```

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Šã€ShiftMasterã®åŒ…æ‹¬çš„ãªé‹ç”¨ç®¡ç†ä½“åˆ¶ãŒç¢ºç«‹ã•ã‚Œã€åŒ»ç™‚æ©Ÿé–¢ã§ã®å®‰å®šçš„ãª24æ™‚é–“365æ—¥é‹ç”¨ãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚

**æœ€çµ‚æ›´æ–°**: 2024å¹´1æœˆ20æ—¥  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ShiftMaster 2.0.0  
**é‹ç”¨æ‹…å½“**: ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ç®¡ç†ãƒãƒ¼ãƒ 
